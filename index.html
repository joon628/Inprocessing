<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Responsive viewport meta tag -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Integrated Inprocessing (Responsive)</title>
  <style>
    /* Basic reset & styling */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      /* Define some material-like color variables */
      --primary-color: #2196F3;   /* Material Blue 500 */
      --primary-dark:  #1976D2;   /* Material Blue 700 */
      --secondary-color: #4CAF50; /* Material Green 500 */
      --secondary-dark: #388E3C;  /* Material Green 700 */
      --light-bg: #f9f9f9;        /* Light background */
      --text-color: #333;
      --header-bg: #ddd;          /* Header background in slider */
      --card-bg: #fff;
      --shadow-color: rgba(0,0,0,0.1);
    }

    body {
      font-family: "Roboto", "Arial", sans-serif;
      background: var(--light-bg);
      /* removed: height: 100vh; overflow: hidden; */
      overflow-x: hidden;  /* no horizontal scrolling */
      -webkit-font-smoothing: antialiased;
      color: var(--text-color);
    }

    .page-content {
      padding: 20px;
      /* removed: height: 100%; to allow natural flow on mobile */
    }

    .hidden {
      display: none !important;
    }

    h1, h2, h3 {
      margin-bottom: 10px;
      font-weight: 500;
      color: var(--text-color);
    }
    p {
      margin-bottom: 10px;
      line-height: 1.5;
    }
    strong {
      color: var(--text-color);
    }
    .section {
      margin-bottom: 30px;
      background: var(--card-bg);
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 4px var(--shadow-color);
    }

    /* Roadmap area */
    .roadmap-container {
      margin-bottom: 40px;
    }
    .roadmap-container h2 {
      margin-bottom: 10px;
      font-weight: 500;
    }
    .roadmap {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }
    .roadmap-item {
      background: var(--secondary-color);
      color: #fff;
      padding: 12px 20px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      text-align: center;
      min-width: 120px;
      box-shadow: 0 2px 4px var(--shadow-color);
      font-size: 1rem;
    }
    .roadmap-item:hover {
      background: var(--secondary-dark);
    }
    .arrow {
      font-size: 1.2rem;
      color: #333;
      user-select: none;
    }

    /* Full-window sliding container */
    .sliding-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #fff;
      z-index: 9999;
      display: none; /* hidden until a building is clicked */
      overflow: hidden; /* main container hidden - slider handles scroll */
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    /* SLIDING HEADER */
    .sliding-header {
      background: var(--header-bg);
      padding: 10px;
      text-align: center;
      position: relative;
      box-shadow: 0 2px 4px var(--shadow-color);
    }
    #modalTitle {
      margin: 0;
      font-size: 1.3rem;
      text-transform: uppercase;
      font-weight: 500;
      color: var(--text-color);
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #444;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.3s;
    }
    .close-btn:hover {
      background: #222;
    }

    .slider {
      position: absolute;
      top: 50px; /* below the header */
      left: 0;
      width: 100%;
      bottom: 60px; 
      background: var(--light-bg);
      overflow: hidden; /* we'll do vertical scroll in each slide */
    }
    .slider-track {
      display: flex;
      width: 100%;
      height: 100%;
      transition: transform 0.4s ease-in-out;
    }
    .slide {
      width: 100%;
      padding: 20px;
      overflow-y: auto; /* each slide can scroll vertically */
      box-sizing: border-box;
      background: #f9f9f9;
    }

    /* Slide content */
    .section-block {
      background-color: #fff;
      padding: 10px 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .section-block h3 {
      margin-bottom: 8px;
      color: #333;
      font-size: 1.1rem;
    }
    .section-block p {
      margin-bottom: 8px;
      line-height: 1.4;
      color: #555;
    }

    /* Checklists */
    ul.checklist {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }
    ul.checklist li {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    ul.checklist label {
      cursor: pointer;
      display: inline-flex;
      align-items: center;
    }
    ul.checklist input[type="checkbox"] {
      margin-right: 6px;
    }

    /* Navigation buttons (Prev/Next) */
    .nav-buttons {
      position: absolute;
      bottom: 10px;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .nav-buttons button {
      padding: 10px 20px;
      cursor: pointer;
      background-color: #007bff;
      color: #fff;
      border-radius: 4px;
      border: none;
      transition: background-color 0.3s, opacity 0.3s;
      font-size: 1rem;
    }
    .nav-buttons button:hover {
      background-color: #0056b3;
    }
    .nav-buttons button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
      opacity: 0.6;
    }
    #prevBtn::before {
      content: "< ";
      margin-right: 5px;
    }
    #nextBtn::after {
      content: " >";
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <div class="page-content">

    <!-- Status / Filter Section -->
    <div class="section" style="margin-bottom: 30px;">
      <h2>Status</h2>
      <label>Rank: 
        <select id="rankSelect">
          <option value="E1">E-1</option>
          <option value="E2">E-2</option>
          <option value="E3">E-3</option>
          <option value="E4">E-4</option>
          <option value="E5">E-5</option>
          <option value="E6">E-6</option>
          <option value="E7">E-7</option>
          <option value="E8">E-8</option>
          <option value="E9">E-9</option>
          <option value="WO1">WO1</option>
          <option value="CW2">CW2</option>
          <option value="CW3">CW3</option>
          <option value="CW4">CW4</option>
          <option value="CW5">CW5</option>
          <option value="O1">O-1</option>
          <option value="O2">O-2</option>
          <option value="O3">O-3</option>
          <option value="O4">O-4</option>
          <option value="O5">O-5</option>
          <option value="O6">O-6</option>
          <option value="O7">O-7</option>
          <option value="O8">O-8</option>
          <option value="O9">O-9</option>
          <option value="O10">O-10</option>
        </select>
      </label>
      <br><br>

      <label><input type="checkbox" id="dependentsCk"> Has Dependents</label><br>
      <label><input type="checkbox" id="driversCk"> Requires Military Driver’s License</label><br>
      <label><input type="checkbox" id="visionCk"> Requires Vision / Specialty Services</label><br>
      <label><input type="checkbox" id="intelCk"> S2/S3 Intel Access</label><br><br>

      <button id="applyBtn">Apply Filter</button>
    </div>

    <!-- Intro Sections -->
    <h1>Welcome to Korea</h1>
    <div class="section">
      <p><strong>Simple description of Korea:</strong> Korea offers a unique blend of modern cities, rich history, and beautiful landscapes. From bustling Seoul to traditional villages, there’s always something to explore.</p>
      <p><strong>Description of Culture:</strong> Korean culture values respect, hierarchy, and group harmony. You’ll notice customs like bowing, removing shoes indoors, and sharing food in communal dishes.</p>
      <p><strong>The KATUSA Program:</strong> KATUSA (Korean Augmentation to the U.S. Army) soldiers serve alongside U.S. forces, bridging cultural and language gaps while supporting mission readiness.</p>
    </div>

    <h1>Welcome to Our Office</h1>
    <div class="section">
      <p><strong>Description of the HHBN OSJA Office:</strong> The HHBN OSJA handles legal support, advice, and documentation for the unit.</p>
      <p><strong>Jobs and Chain of Command (COC):</strong>  
        <br>• <strong>Foundations: </strong> COL Babb, LTC Runyans, WO1 Delgado, SGM Cabrera 
        <br>• <strong>Officers: </strong> MAJ Preston, CPT Baxter, CPT Strickland, CPT Smith    
        <br>• <strong>NCO: </strong> SSG Jackson, SFC Bradley, SFC Spencer, SSG Winton, SSG OA 
        <br>• <strong>Korean Counterparts: </strong> 1LT Rhee
        <br>• <strong>KATUSA: </strong> PFC Kim, PFC Kang
      </p>
      <p><strong>Installable Apps:</strong> “OnPost” (iOS) or “MyArmyPost” (Android).</p>
    </div>


    <!-- Roadmap Container -->
    <div class="roadmap-container">
      <h2>Inprocessing Roadmap</h2>
      <div class="roadmap">
        <div class="roadmap-item" data-building="OneStop" id="oneStopItem">OneStop</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="CIF" id="cifItem">CIF</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="BattalionPart1" id="batt1Item">Battalion Part 1</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="PostOffice" id="postOfficeItem">Post Office</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="BattalionPart2" id="batt2Item">Battalion Part 2</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="Company" id="companyItem">Company</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="BattalionPart3" id="batt3Item">Battalion Part 3</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="Division" id="divisionItem">Division</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="S7010" id="s7010Item">BLDG S7010</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="Housing" id="housingItem">Housing/SLQ</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="MedicalBldg" id="medicalBldgItem">Medical Company</div>
        <span class="arrow">→</span>
        <div class="roadmap-item" data-building="MidtownClinic" id="midtownItem">Midtown Clinic</div>
      </div>
    </div>

    <!-- Tips Section -->
    <h2>Tips and Tricks</h2>
    <div class="section">
  <p><strong>DSN calls from your phone: </strong>To call DSN numbers, add 0503 in front of DSN, leave out the first 3 digits, replace the first digit of the remaining with 3</p>	
  <p><strong>Cars and Licenses: </strong>JKO Korean Driving License Course, JKO Driving License Exam, TMP License Required.</p>
    </div>	

  <!-- Sliding Container -->
  <div class="sliding-container" id="slidingContainer">
    <div class="sliding-header">
      <button class="close-btn" id="closeWindow">Close</button>
      <h2 id="modalTitle">Details</h2>
    </div>
    <div class="slider">
      <div class="slider-track" id="sliderTrack"></div>
    </div>
    <div class="nav-buttons">
      <button id="prevBtn">Prev</button>
      <button id="nextBtn">Next</button>
    </div>
  </div>

<script>
  const buildingData = {
      OneStop: {
        name: "OneStop",
        sections: [
          {
            Section: "OneStop Inprocessing",
            Description: "This is your first step for inprocessing before HHBN.",
            Requirements: [""],
            NeedToCompleteOnSite: ["Complete Inprocessing, TRICARE", "Hearing Test"],
            POC: "OneStop",
            DSN: "N/A",
            Hours: "Mon-Fri 0800-1700"
          }
        ]
      },
      CIF: {
        name: "CIF",
        sections: [
          {
            Section: "Central Issue Facility",
            Description: "Pick up gear from CIF. Usually done collectively on Thursday with your sponser.",
            Requirements: ["DA 4187"],
            NeedToCompleteOnSite: ["Obtain gear", "Keep receipts for S4"],
            POC: "CIF Clerk",
            DSN: "123-4567",
            Hours: "Thu recommended"
          }
        ]
      },
      BattalionPart1: {
        name: "Battalion Part 1",
        sections: [
          {
            Section: "S1 BLDG 7300, 2nd Floor",
            Description: "Start of Battalion Inprocessing, Guides to Inprocessing in Korea",
            Requirements: [
              "Copy of PCS Order",
              "DD93",
              "Signed DA31",
              "Pinpoint PCS Order",
              "SGLI/SGLV/PRR"
            ],
            NeedToCompleteOnSite: [
              "Complete Personal Data Sheet",
              "If CSP, complete NEO packet",
              "Update religious preference"
            ],
            POC: "S1 Civilian Services/KATUSA",
            DSN: "7571775 / 7567387",
            Hours: "Mon-Fri, 0900-1600"
          },
          {
            Section: "HHBN Career Counselor, BLDG 7300, 2nd Floor",
            Description: "Mandatory for SSG and below (Retention Brief)",
            Requirements: [],
            NeedToCompleteOnSite: ["Attend retention briefing"],
            POC: "Career Counselor",
            DSN: "-",
            Hours: "-"
          }
        ]
      },
      PostOffice: {
        name: "Post Office",
        sections: [
          {
            Section: "Cowan Post Office (BLDG P6809)",
            Description: "Pick up mail, set up mailbox if needed",
            Requirements: ["Pin Point Order"],
            NeedToCompleteOnSite: ["Register or update mailing address"],
            POC: "-",
            DSN: "-",
            Hours: "-"
          }
        ]
      },
      BattalionPart2: {
        name: "Battalion Part 2",
        sections: [
          {
            Section: "S3, BLDG 7300, 2nd Floor",
            Description: "Tribe In-Processing",
            Requirements: [
              {
                id:"range operations",
                title: "Range Operations Professional Development (ROPD) Phase 4A Course",
                url: "https://www.lms.army.mil/Saba/Web/ALMS",
                frequency: "",
                note: "Required for E6-E8, W01-CW2, O1-O4"
              }, "CIF Reciept", "POBOX Number"
          ],
            NeedToCompleteOnSite: [],
            POC: "S3 KATUSA",
            DSN: "7567390",
            Hours: "-"
          },
          {
            Section: "S6",
            Description: "Get access to NIPR and Centrix accounts",
            Requirements: [
              {
                id:"DODCyber",
                title: "DOD Cyber Awareness",
                url: "https://cs.signal.army.mil/",
                frequency: "",
                note: "Do not use JKO"
              },
              {
                id:"MilConnect",
                title: "Update MILCONNECT",
                url: "https://milconnect.dmdc.osd.mil/milconnect/",
                frequency: "",
                note: ""
              },
              {
                id:"AUPForm",
                title: "Complete Acceptable Use Policy Form",
                url: "https://cs.signal.army.mil/UserMngmt/aup/aupsig.asp",
                frequency: "",
                note: "For NIPR"
              },
              {
                id:"ATCTS",
                title: "Update ATCTS profile",
                url: "https://atc.us.army.mil/iastar/profile/index.php",
                frequency: "",
                note: ""
              }
            ],
            NeedToCompleteOnSite: [],
            POC: "S6 KATUSA",
            DSN: "7567392",
            Hours: "-"
          }
        ]
      },
      Company: {
        name: "Company",
        sections: [
          {
            Section: "Orderly Room",
            Description: "Inprocessing at the company level",
            Requirements: ["Personal Data Sheet"],
            NeedToCompleteOnSite: [],
            POC: "Orderly KATUSA",
            DSN: "7571878",
            Hours: "-"
          },
          {
            Section: "CBRN",
            Description: "Receive CBRN gear",
            Requirements: [],
            NeedToCompleteOnSite: ["Pick up/verify gear"],
            POC: "CBRN NCO",
            DSN: "7372273",
            Hours: "-"
          },
          {
            Section: "Arms Room",
            Description: "Receive personal weapons or sign a weapons card",
            Requirements: ["Write weapons card"],
            NeedToCompleteOnSite: ["Confirm personal weapons assignment"],
            POC: "-",
            DSN: "-",
            Hours: "-"
          }
        ]
      },
      BattalionPart3: {
        name: "Battalion Part 3",
        sections: [
          {
            Section: "S4",
            Description: "Report filings from the CIF",
            Requirements: ["Completed CIF receipt"],
            NeedToCompleteOnSite: [],
            POC: "S4 NCOIC/S4 KATUSA/S4 Civilian",
            DSN: "7656357 / 7567438 / 7567436",
            Hours: "-"
          },
          {
            Section: "S2, BLDG 7300, 2nd Floor",
            Description: "Certifications & Security, Submit certifications",
            Requirements: [
              {
                id: "antiterror",
                title: "Level I Antiterrorism Awareness Training [JKO prefix=JS course=US007]",
                url: "https://jkodirect.jten.mil/",
                frequency: "annual (all DoD personnel)",
                note: ""
              },
              {
                id: "sere100",
                title: "SERE 100.2 [JKO prefix=J3T course=A-US1329]",
                url: "https://jkodirect.jten.mil/",
                frequency: "every 24 months (all DoD personnel)",
                note: ""
              },
              {
                id: "infosec",
                title: "Information Security Program Training",
                url: "https://www.cdse.edu/Training/eLearning/lF011",
                frequency: "annual (all DoD personnel)",
                note: "(DO NOT LOG IN WITH YOUR CAC. MAKE A NEW ACCOUNT WITHOUT CAC)"
              },
              {
                id: "managingPersonnel",
                title: "Managing Personnel w/ Security Clearances",
                url: "https://learn.atis.army.mil/moodle/course/",
                frequency: "annual (Civilian Supervisors & all Military)",
                note: "(Search “Security Training – Annual Awareness Managing Personnel with Clearances/Access to Classified Information”)"
              },
              {
                id: "unauthorizedDisclosure",
                title: "Unauthorized Disclosure of Classified Information and CUI",
                url: "https://www.cdse.edu/Training/eLearning/lF130/",
                frequency: "annual",
                note: "(DO NOT LOG IN WITH YOUR CAC. MAKE A NEW ACCOUNT WITHOUT CAC)"
              },
              {
                id: "derivativeClass",
                title: "Derivative Classification",
                url: "https://securityawareness.usalearning.gov/derivative/index.htm",
                frequency: "annual (all DoD personnel)",
                note: ""
              },
              {
                id: "markingClass",
                title: "Marking Classified",
                url: "https://securityawareness.usalearning.gov/markings/index.html",
                frequency: "annual (all DoD personnel)",
                note: ""
              },
              {
                id: "dodCui",
                title: "DOD CUI Training Certificate",
                url: "https://securityawareness.usalearning.gov/cui/index.html",
                frequency: "annual (all DoD personnel)",
                note: ""
              },
              {
                id: "indoPacom",
                title: "USINDOPACOM Intelligence Oversight [JKO prefix=PAC course=US009]",
                url: "https://jkodirect.jten.mil/",
                frequency: "annual (only S2/C2/C39 CEMA with intel mission)",
                note: "(**Re-check if still required**)"
              },
              {
                id: "isoprep",
                title: "ISOPREP Manager Validation",
                url: "#",
                frequency: "",
                note: ""
              }
            ],
            NeedToCompleteOnSite: ["Sign NDA/NATO agreements", "SF312 NDA", "NATO Indoctrination Brief"],
            POC: "S2 SGT/KATUSA",
            DSN: "7567389 / 7567388",
            Hours: "-"
          }
        ]
      },
      Division: {
        name: "Division",
        sections: [
          {
            Section: "C8, BLDG 6500, 3rd floor",
            Description: "Government Travel Credit Card (GTCC) issuance",
            Requirements: [
              "Travel Card Training 101",
              "DTS Cert",
              "DTS 101",
              "TDY Travel Policies Cert",
              "GTCC Statement of Understanding"
            ],
            NeedToCompleteOnSite: ["File GTCC application if you don't have it"],
            POC: "-",
            DSN: "-",
            Hours: "-"
          },
          {
            Section: "Badging",
            Description: "Generates badges for entering Division (must have sponsor initially)",
            Requirements: ["CI TARP Briefing at 0850 @BLDG 6500, Security Briefing SETA"],
            NeedToCompleteOnSite: ["Obtain 2ID Entrance Badge for Classified Areas"],
            POC: "Badging",
            DSN: "7567244 / 7565016",
            Hours: "-"
          }, 
          {
            Section: "OSJA Office, BLDG 6500, 3rd Floor",
            Description: "Legal assistance, claims, and advice",
            Requirements:[
              "STP", 
              "Copy of Orders and Amendments (1st term JA submit DCC & OBC orders)", 
              "Last OER/NCOER/AER (digital copy of evaluation sheet)",
              "Copy of Current Profile", 
              "Statement of Good Standing (JAs Only)", 
              "JATSOC Completion Certificate (JAs Only)",
            ], 
            NeedToCompleteOnSite: ["Admin Data Sheet","FB Bios"],
            POC: "OSJA KATUSA",
            DSN: "7563572",
            Hours: "Mon-Fri, 0930 - 1130, 1300 - 1630"
          }
        ]
      },
      S7010: {
        name: "BLDG S7010",
        sections: [
          {
            Section: "TMP License",
            Description: "Obtain a TMP (Transport Motor Pool) license if required",
            Requirements: [],
            NeedToCompleteOnSite: ["Present driver’s license, complete required forms"],
            POC: "-",
            DSN: "-",
            Hours: "-"
          }
        ]
      },
      Housing: {
        name: "Housing/SLQ",
        sections: [
          {
            Section: "Housing Office (BLDG 6400, 3rd Floor)",
            Description: "(For Officers, E7+, or accompanied) Housing or SLQ assignment. For Unaccompanied E-6 and below, Visit P6701",
            Requirements: [],
            NeedToCompleteOnSite: ["Confirm eligibility, pick up keys if assigned"],
            POC: "Housing Office",
            DSN: "7572647",
            Hours: "-"
          }
        ]
      },
      MedicalBldg: {
        name: "Medical Company COF",
        sections: [
          {
            Section: "Medical Inprocessing, BLDG 7309 RM 210",
            Description: "TCCC Level 1, Phase 1 PHA, Immunization records check",
            Requirements: ["Complete Phase 1 PHA through AKO", "Ensure immunization record is updated"],
            NeedToCompleteOnSite: ["Finish missing immunizations", "Finalize PHA"],
            POC: "-",
            DSN: "-",
            Hours: "-"
          }
        ]
      },
      MidtownClinic: {
        name: "Midtown Clinic (BLDG 6370)",
        sections: [
          {
            Section: "Vision / Additional Medical Support",
            Description: "Check if vision or other specialty services are required",
            Requirements: ["Immunization Vaccine Receipt"],
            NeedToCompleteOnSite: ["Vision","Immunization"],
            POC: "-",
            DSN: "-",
            Hours: "-"
          }
        ]
      }
    };

let currentSlideIndex = 0;
let totalSlides = 0;
let intelAccess = false;

// Questionnaire
const rankSelect = document.getElementById('rankSelect');
const dependentsCk = document.getElementById('dependentsCk');
const driversCk = document.getElementById('driversCk');
const visionCk = document.getElementById('visionCk');
const intelCk = document.getElementById('intelCk');
const applyBtn = document.getElementById('applyBtn');

// Roadmap items
const oneStopItem = document.getElementById('oneStopItem');
const cifItem = document.getElementById('cifItem');
const batt1Item = document.getElementById('batt1Item');
const postOfficeItem = document.getElementById('postOfficeItem');
const batt2Item = document.getElementById('batt2Item');
const companyItem = document.getElementById('companyItem');
const batt3Item = document.getElementById('batt3Item');
const divisionItem = document.getElementById('divisionItem');
const s7010Item = document.getElementById('s7010Item');
const housingItem = document.getElementById('housingItem');
const medicalBldgItem = document.getElementById('medicalBldgItem');
const midtownItem = document.getElementById('midtownItem');

// Slider elements
const roadmapItems = document.querySelectorAll('.roadmap-item');
const slidingContainer = document.getElementById('slidingContainer');
const modalTitle = document.getElementById('modalTitle');
const sliderTrack = document.getElementById('sliderTrack');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const closeWindow = document.getElementById('closeWindow');

window.addEventListener('DOMContentLoaded', () => {
  restoreCheckboxes();
});

applyBtn.addEventListener('click', () => {
  applyQuestionnaireFilters();
  // Reset the slider if open
  slidingContainer.style.display = 'none';
  currentSlideIndex = 0;
});

function applyQuestionnaireFilters() {
  const rank = rankSelect.value;
  const hasDependents = dependentsCk.checked;
  const needsDriver = driversCk.checked;
  const needsVision = visionCk.checked;
  intelAccess = intelCk.checked;

  // Show Housing if rank≥E7 or hasDependents
  const highRanks = ["E7","E8","E9","WO1","CW2","CW3","CW4","CW5","O1","O2","O3","O4","O5","O6","O7","O8","O9","O10"];
  const showHousing = (highRanks.includes(rank) || hasDependents);

  if (showHousing) {
    housingItem.classList.remove('hidden');
  } else {
    housingItem.classList.add('hidden');
  }

  // S7010 if needsDriver
  if (needsDriver) {
    s7010Item.classList.remove('hidden');
  } else {
    s7010Item.classList.add('hidden');
  }

  // Midtown if needsVision
  if (needsVision) {
    midtownItem.classList.remove('hidden');
  } else {
    midtownItem.classList.add('hidden');
  }

  alert("Filter Applied. Roadmap updated!");
}

/** Build slides for chosen building **/
function loadBuildingSlides(buildingKey) {
  sliderTrack.innerHTML = '';
  currentSlideIndex = 0;

  const building = buildingData[buildingKey];
  if (!building) {
    console.error("No building found:", buildingKey);
    modalTitle.textContent = "Details for: (Not Found)";
    totalSlides = 0;
    updateButtonStates();
    return;
  }
  modalTitle.textContent = `Details for: ${building.name}`;

  if (!building.sections || building.sections.length === 0) {
    console.warn("No sections for building:", buildingKey);
    totalSlides = 0;
    updateButtonStates();
    return;
  }

  // Build slides
  building.sections.forEach((sec, idx) => {
    const slide = document.createElement('div');
    slide.classList.add('slide');

    const sectionBlock = document.createElement('div');
    sectionBlock.classList.add('section-block');

    // Title
    const h3 = document.createElement('h3');
    h3.textContent = sec.Section || 'Unnamed Section';
    sectionBlock.appendChild(h3);

    // Description
    if (sec.Description) {
      const pDesc = document.createElement('p');
      pDesc.innerHTML = `<strong>Description:</strong> ${sec.Description}`;
      sectionBlock.appendChild(pDesc);
    }

    // Requirements
    if (sec.Requirements && sec.Requirements.length > 0) {
      const reqTitle = document.createElement('p');
      reqTitle.innerHTML = `<strong>Requirements:</strong>`;
      sectionBlock.appendChild(reqTitle);

      const reqList = document.createElement('ul');
      reqList.classList.add('checklist');

      sec.Requirements.forEach((r, i2) => {
        if (typeof r === 'object' && r.url) {
          const uniqueId = `${buildingKey}-sec${idx}-req${i2}-${r.id}`;
          const li = document.createElement('li');
          let linkHTML = `
            <label>
              <input type="checkbox" data-id="${uniqueId}" />
          `;

          if (r.id === "indoPacom" && !intelAccess) {
            linkHTML += `<span style="color:#999;text-decoration:line-through;">${r.title}</span></label>`;
          } else if (r.id === "range operations" && ["E6", "E7", "E8", "WO1", "CW2", "O1", "O2", "O3", "O4"].includes(rankSelect.value)) {
            linkHTML += `<span style="color:#999;text-decoration:line-through;">${r.title}</span></label>`;
          } else {
            linkHTML += `<a href="${r.url}" target="_blank">${r.title}</a></label>`;
          }

          if (r.frequency) linkHTML += ` – ${r.frequency}`;
          if (r.note) linkHTML += `<br><em>${r.note}</em>`;
          li.innerHTML = linkHTML;
          reqList.appendChild(li);
        } else {
          const uniqueId = `${buildingKey}-sec${idx}-req${i2}`;
          const li = document.createElement('li');
          li.innerHTML = `<label><input type="checkbox" data-id="${uniqueId}" /> ${r}</label>`;
          reqList.appendChild(li);
        }
      });
      sectionBlock.appendChild(reqList);
    }

    // NeedToCompleteOnSite
    if (sec.NeedToCompleteOnSite && sec.NeedToCompleteOnSite.length > 0) {
      const needTitle = document.createElement('p');
      needTitle.innerHTML = `<strong>Need to Complete on Site:</strong>`;
      sectionBlock.appendChild(needTitle);

      const needList = document.createElement('ul');
      needList.classList.add('checklist');

      sec.NeedToCompleteOnSite.forEach((n, i3) => {
        const uniqueId = `${buildingKey}-sec${idx}-need${i3}`;
        const li = document.createElement('li');
        li.innerHTML = `<label><input type="checkbox" data-id="${uniqueId}" /> ${n}</label>`;
        needList.appendChild(li);
      });
      sectionBlock.appendChild(needList);
    }

    // POC, DSN, Hours
    if (sec.POC && sec.POC !== '-') {
      const pPOC = document.createElement('p');
      pPOC.innerHTML = `<strong>POC:</strong> ${sec.POC}`;
      sectionBlock.appendChild(pPOC);
    }
    if (sec.DSN && sec.DSN !== '-') {
      const pDSN = document.createElement('p');
      pDSN.innerHTML = `<strong>DSN:</strong> ${sec.DSN}`;
      sectionBlock.appendChild(pDSN);
    }
    if (sec.Hours && sec.Hours !== '-') {
      const pHours = document.createElement('p');
      pHours.innerHTML = `<strong>Hours of Operation:</strong> ${sec.Hours}`;
      sectionBlock.appendChild(pHours);
    }

    slide.appendChild(sectionBlock);
    sliderTrack.appendChild(slide);
  });

  totalSlides = building.sections.length;
  sliderTrack.style.width = `${totalSlides * 100}%`;
  updateSliderPosition();
  restoreCheckboxes();
  updateButtonStates();
}

/** Moves the slider horizontally based on currentSlideIndex */
function updateSliderPosition() {
  if (totalSlides === 0) return;
  const offset = -currentSlideIndex * (100 / totalSlides);
  sliderTrack.style.transform = `translateX(${offset}%)`;
}

/** Control Prev/Next states. */
function updateButtonStates() {
  prevBtn.disabled = (currentSlideIndex <= 0);
  nextBtn.disabled = (currentSlideIndex >= totalSlides - 1);
}

/** Show slider container on building click */
roadmapItems.forEach(item => {
  item.addEventListener('click', () => {
    const buildingKey = item.getAttribute('data-building');
    loadBuildingSlides(buildingKey);
    slidingContainer.style.display = 'block';
  });
});

/** Close slider */
closeWindow.addEventListener('click', () => {
  slidingContainer.style.display = 'none';
});

/** Prev/Next nav */
nextBtn.addEventListener('click', () => {
  if (totalSlides === 0) return;
  currentSlideIndex++;
  if (currentSlideIndex > totalSlides - 1) currentSlideIndex = totalSlides - 1;
  updateSliderPosition();
  updateButtonStates();
});
prevBtn.addEventListener('click', () => {
  if (totalSlides === 0) return;
  currentSlideIndex--;
  if (currentSlideIndex < 0) currentSlideIndex = 0;
  updateSliderPosition();
  updateButtonStates();
});

/** Restores checkboxes from localStorage. */
function restoreCheckboxes() {
  const allCheckboxes = document.querySelectorAll('input[type="checkbox"][data-id]');
  allCheckboxes.forEach(cb => {
    const id = cb.getAttribute('data-id');
    if (localStorage.getItem(id) === 'checked') {
      cb.checked = true;
    }
    cb.addEventListener('change', () => {
      if (cb.checked) {
        localStorage.setItem(id, 'checked');
      } else {
        localStorage.removeItem(id);
      }
    });
  });
}
</script>
</body>
</html>
